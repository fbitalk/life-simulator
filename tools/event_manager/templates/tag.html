{% extends "base.html" %}

{% block title %}{{ tag_name }} - {{ display_name }}{% endblock %}

{% block breadcrumb %}
<span class="breadcrumb-sep">/</span>
<a href="{{ url_for('category', filename=filename) }}">{{ display_name }}</a>
<span class="breadcrumb-sep">/</span>
<a href="{{ url_for('tag_events', filename=filename, tag_name=tag_name) }}">{{ tag_name }}</a>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ“ {{ tag_name }}</h1>
    <p class="subtitle">å…± {{ events|length }} ä¸ªäº‹ä»¶</p>
</div>

<div class="tag-settings card">
    <h3>âš™ï¸ æ ‡ç­¾è®¾ç½®</h3>
    <form action="{{ url_for('tag_events', filename=filename, tag_name=tag_name) }}" method="post">
        <div class="form-group">
            <label>æè¿°:</label>
            <input type="text" name="description" value="{{ tag_data.description or '' }}" placeholder="æ ‡ç­¾æè¿°"
                class="full-width">
        </div>

        {% if filename in ['purpleEvents.js', 'pinkEvents.js'] %}
        <div class="form-group">
            <label>å›ºå®šå±æ€§:</label>
            <div class="fixed-attrs-grid">
                <div class="attr-input">
                    <span>ä½“è´¨:</span>
                    <input type="number" name="fixed_health"
                        value="{{ tag_data.get('fixed_attributes', {}).get('health', '') }}">
                </div>
                <div class="attr-input">
                    <span>å®¶å¢ƒ:</span>
                    <input type="number" name="fixed_money"
                        value="{{ tag_data.get('fixed_attributes', {}).get('money', '') }}">
                </div>
                <div class="attr-input">
                    <span>å¿«ä¹:</span>
                    <input type="number" name="fixed_social"
                        value="{{ tag_data.get('fixed_attributes', {}).get('social', '') }}">
                </div>
                <div class="attr-input">
                    <span>æ™ºåŠ›:</span>
                    <input type="number" name="fixed_intelligence"
                        value="{{ tag_data.get('fixed_attributes', {}).get('intelligence', '') }}">
                </div>
                <div class="attr-input">
                    <span>è¿æ°”:</span>
                    <input type="number" name="fixed_luck"
                        value="{{ tag_data.get('fixed_attributes', {}).get('luck', '') }}">
                </div>
                <div class="attr-input">
                    <span>å¿ƒæƒ…:</span>
                    <input type="number" name="fixed_san"
                        value="{{ tag_data.get('fixed_attributes', {}).get('san', '') }}">
                </div>
            </div>
        </div>
        {% endif %}

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">ä¿å­˜æ ‡ç­¾è®¾ç½®</button>
        </div>
    </form>
</div>

<div class="toolbar">
    <form action="{{ url_for('add_event', filename=filename, tag_name=tag_name) }}" method="post" class="inline-form">
        <input type="text" name="event_id" placeholder="äº‹ä»¶ID (è‹±æ–‡)" required pattern="[a-zA-Z0-9_]+">
        <button type="submit" class="btn btn-primary">+ æ·»åŠ äº‹ä»¶</button>
    </form>
</div>

<div class="event-list">
    {% for event in events %}
    <div class="event-item {% if event.is_continue %}event-continue{% endif %}">
        <div class="event-order-controls">
            {% if not loop.first %}
            <form
                action="{{ url_for('move_event', filename=filename, tag_name=tag_name, event_id=event.id, direction='up') }}"
                method="post" class="move-form">
                <button type="submit" class="btn btn-small btn-move" title="ä¸Šç§»">â†‘</button>
            </form>
            {% else %}
            <button class="btn btn-small btn-move" disabled>â†‘</button>
            {% endif %}
            {% if not loop.last %}
            <form
                action="{{ url_for('move_event', filename=filename, tag_name=tag_name, event_id=event.id, direction='down') }}"
                method="post" class="move-form">
                <button type="submit" class="btn btn-small btn-move" title="ä¸‹ç§»">â†“</button>
            </form>
            {% else %}
            <button class="btn btn-small btn-move" disabled>â†“</button>
            {% endif %}
        </div>
        <a href="{{ url_for('event_edit', filename=filename, tag_name=tag_name, event_id=event.id) }}"
            class="event-link">
            <div class="event-header">
                <span class="event-id">{{ event.id }}</span>
                <span class="event-badge badge-age">ğŸ‚ {{ event.age_range[0] }} - {{ event.age_range[1] }} å²</span>
                {% if event.priority > 0 %}
                <span class="event-priority priority-high">ä¼˜å…ˆçº§: {{ event.priority }}</span>
                {% endif %}
                {% if event.is_continue %}
                <span class="event-badge badge-continue">è¿ç»­äº‹ä»¶</span>
                {% endif %}
                {% if event.allow_repeat %}
                <span class="event-badge badge-repeat">å¯é‡å¤</span>
                {% endif %}
            </div>
            <h3 class="event-title">{{ event.title }}</h3>
            <p class="event-desc">{{ event.description }}</p>
        </a>
        <form action="{{ url_for('delete_event', filename=filename, tag_name=tag_name, event_id=event.id) }}"
            method="post" class="event-delete-form" onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤äº‹ä»¶ ã€Œ{{ event.title }}ã€ å—ï¼Ÿ');">
            <button type="submit" class="btn btn-danger btn-small">åˆ é™¤</button>
        </form>
    </div>
    {% else %}
    <div class="empty-state">
        <p>æš‚æ— äº‹ä»¶</p>
        <p class="hint">ä½¿ç”¨ä¸Šæ–¹è¡¨å•æ·»åŠ ç¬¬ä¸€ä¸ªäº‹ä»¶</p>
    </div>
    {% endfor %}
</div>
{% endblock %}